#! /bin/bash

###################################################################################################################################
# Progarm: upsys means update the system (automatically)!
# Version: 0.02
# Purpose: This is a simple tool get all updating tasks done automatically instead type each call to update your system 
# Author:  Leonardo Setti
# Created date: 27/11/2018
# Last modification: 14/07/2019
# 
# --- GUIDE:
#
# As system user who wants get your system updated rapidly with a single command, just call upsys to run the commonly apt commands

# UPDATES:

# 1. connection verification is made before updates startsand. 

# TODO
#
# 1. Make the output less noisy and more readable;
# 2. Add usefull and friendly messages for output;
# 3. Make a verification download speed is higher than 4Mbps, 
#    otherwise terminate the process with a message telling the user have a bad connection;
# 4. Provide a log of results when things goes bad;
# 5. Provide a generall log status;
# 6. Give to user a choice to flag the upsys as a recurrent service, maybe with crontab or equivalent
#
#
# XXX
#
#
###################################################################################################################################

clear
f_today()
	{
	TODAY=`date`
	echo ${TODAY:8:3}${TODAY:4:4}${TODAY:23:5}
	}
	
f_timenow()
	{
	TIMENOW=`date`
	echo ${TIMENOW:11:8}
	}

check_connection()
	{			
	if ping -q -c 1 -W 1 8.8.8.8 >/dev/null; then
	  C_STATUS=1
	else
	  C_STATUS=0
	fi
	echo $C_STATUS 
	}

connect_status=$(check_connection)
if [ $connect_status -eq 1 ]; then 
echo 'You are online!'
SAGUD='sudo apt-get update'
SAGUG='sudo apt-get upgrade -y'
SAGDU='sudo apt-get dist-upgrade -y'
SAGAC='sudo apt-get autoclean'
SAGAR='sudo apt-get autoremove'

echo "--------------------------------------------------------------------------------------------------------------"

echo "______________________________________________________________________________________________________________"
echo "#  Current User: "`whoami`
echo "#  Today: " $(f_today) Time now: $(f_timenow)
echo "______________________________________________________________________________________________________________"
echo '' 
echo '' 
echo "______________________________________________________________________________________________________________"
echo ">>>>>>>>>> Updating sources:"
echo "______________________________________________________________________________________________________________"
echo '' 
$SAGAR && $SAGUD 
echo '' 
echo "______________________________________________________________________________________________________________"
echo ">>>>>>>>>> Upgrading elegible softwares and distro if possible"
echo "______________________________________________________________________________________________________________"
echo ''
$SAGUG 
$SAGDU
echo '' 
echo "______________________________________________________________________________________________________________"
echo ">>>>>>>>>> Cleaning remaining pieces"
echo "______________________________________________________________________________________________________________"
echo ''
$SAGAR && $SAGAC
echo '' 
echo "##############################################################################################################"
echo "#  If you have no issues with your connection, all steps should have been completed successfully, good luck! #"
echo "#  Update process is DONE!                                                                                   #"
echo "##############################################################################################################"
echo ''
echo ''

else
	echo 'you are offline'
fi

exit 0
